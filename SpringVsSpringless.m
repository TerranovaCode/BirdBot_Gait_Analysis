load BirdBot_Data.mat

q1= q1_0+linspace(0,-25,200)'*pi/180;
q2=(q2_0+(-5)*(1-cos(2*pi*linspace(0,1,200)'))*pi/180*(rK/rA));
t=linspace(0,0.5,200)';

n=length(q1);
n=length(q1);

q1dot=diff(q1)./diff(t);
q1dot=[q1dot;q1dot(n-1)]; %adding elmement so size is same 
q2dot=diff(q2)./diff(t);
q2dot=[q2dot;q2dot(n-1)];
UsSpringless=[];
q1doubledot=diff(q1dot)./diff(t);
q1doubledot=[q1doubledot(1);q1doubledot];

q2doubledot=diff(q2dot)./diff(t);
q2doubledot=[q2doubledot(1);q2doubledot];
for i=1:n
x(1)=q1(i);
x(2)=q2(i);
x(3)=q1dot(i);
x(4)=q2dot(i);
Dspringless =...
[(1243*(l4*cos(x(1) - (1859*pi)/18000 + x(2)) + l6*cos(x(1)) + a2*cos((1859*pi)/18000 - x(1)) + cos((1859*pi)/18000 - x(1))*(l5 - 30))^2)/50 + (3877*(l6*cos(x(1)) + a5*cos((1859*pi)/18000 - x(1)))^2)/100 + (3877*(l6*sin(x(1)) - a5*sin((1859*pi)/18000 - x(1)))^2)/100 + (1243*(l4*sin(x(1) - (1859*pi)/18000 + x(2)) + l6*sin(x(1)) - a2*sin((1859*pi)/18000 - x(1)) - sin((1859*pi)/18000 - x(1))*(l5 - 30))^2)/50 + (2457*(l6*cos(x(1)) + cos((1859*pi)/18000 - x(1))*(l5 - 30) - a4*cos(x(1) - (1859*pi)/18000 + x(2)))^2)/100 + (1527*a6^2*cos(x(1))^2)/100 + (1527*a6^2*sin(x(1))^2)/100 + (2457*(a4*sin(x(1) - (1859*pi)/18000 + x(2)) + l6*sin(x(1)) - sin((1859*pi)/18000 - x(1))*(l5 - 30))^2)/100, (1243*l4*sin(x(1) - (1859*pi)/18000 + x(2))*(l4*sin(x(1) - (1859*pi)/18000 + x(2)) + l6*sin(x(1)) - a2*sin((1859*pi)/18000 - x(1)) - sin((1859*pi)/18000 - x(1))*(l5 - 30)))/50 - (2457*a4*cos(x(1) - (1859*pi)/18000 + x(2))*(l6*cos(x(1)) + cos((1859*pi)/18000 - x(1))*(l5 - 30) - a4*cos(x(1) - (1859*pi)/18000 + x(2))))/100 + (2457*a4*sin(x(1) - (1859*pi)/18000 + x(2))*(a4*sin(x(1) - (1859*pi)/18000 + x(2)) + l6*sin(x(1)) - sin((1859*pi)/18000 - x(1))*(l5 - 30)))/100 + (1243*l4*cos(x(1) - (1859*pi)/18000 + x(2))*(l4*cos(x(1) - (1859*pi)/18000 + x(2)) + l6*cos(x(1)) + a2*cos((1859*pi)/18000 - x(1)) + cos((1859*pi)/18000 - x(1))*(l5 - 30)))/50];
[                                        (1243*l4*sin(x(1) - (1859*pi)/18000 + x(2))*(l4*sin(x(1) - (1859*pi)/18000 + x(2)) + l6*sin(x(1)) - a2*sin((1859*pi)/18000 - x(1)) - sin((1859*pi)/18000 - x(1))*(l5 - 30)))/50 - (2457*a4*cos(x(1) - (1859*pi)/18000 + x(2))*(l6*cos(x(1)) + cos((1859*pi)/18000 - x(1))*(l5 - 30) - a4*cos(x(1) - (1859*pi)/18000 + x(2))))/100 + (2457*a4*sin(x(1) - (1859*pi)/18000 + x(2))*(a4*sin(x(1) - (1859*pi)/18000 + x(2)) + l6*sin(x(1)) - sin((1859*pi)/18000 - x(1))*(l5 - 30)))/100 + (1243*l4*cos(x(1) - (1859*pi)/18000 + x(2))*(l4*cos(x(1) - (1859*pi)/18000 + x(2)) + l6*cos(x(1)) + a2*cos((1859*pi)/18000 - x(1)) + cos((1859*pi)/18000 - x(1))*(l5 - 30)))/50,                                                                                                                                                                                                                                                                                                                                                                                                                                                                 (2457*a4^2*cos(x(1) - (1859*pi)/18000 + x(2))^2)/100 + (1243*l4^2*cos(x(1) - (1859*pi)/18000 + x(2))^2)/50 + (2457*a4^2*sin(x(1) - (1859*pi)/18000 + x(2))^2)/100 + (1243*l4^2*sin(x(1) - (1859*pi)/18000 + x(2))^2)/50];
 
 
Cspringless =...
[(4290322519079623*a2*sin((1859*pi)/18000 - x(1)))/17592186044416 - (4290322519079623*l4*sin(x(1) - (1859*pi)/18000 + x(2)))/17592186044416 - (2635286599611659*a6*sin(x(1)))/17592186044416 - (30442996474885179*l6*sin(x(1)))/35184372088832 - (8480549018003729*a4*sin(x(1) - (1859*pi)/18000 + x(2)))/35184372088832 + (3345450604680551*a5*sin((1859*pi)/18000 - x(1)))/8796093022208 + (3877*(l6*sin(x(1)) - a5*sin((1859*pi)/18000 - x(1)))*(l6*cos(x(1))*x(3)^2 + a5*cos((1859*pi)/18000 - x(1))*x(3)^2))/100 - (3877*(l6*sin(x(1))*x(3)^2 - a5*sin((1859*pi)/18000 - x(1))*x(3)^2)*(l6*cos(x(1)) + a5*cos((1859*pi)/18000 - x(1))))/100 + (2457*(a4*sin(x(1) - (1859*pi)/18000 + x(2)) + l6*sin(x(1)) - sin((1859*pi)/18000 - x(1))*(l5 - 30))*(l6*cos(x(1))*x(3)^2 + a4*cos(x(1) - (1859*pi)/18000 + x(2))*(x(3) + x(4))^2 + cos((1859*pi)/18000 - x(1))*x(3)^2*(l5 - 30)))/100 + (2457*(l6*cos(x(1)) + cos((1859*pi)/18000 - x(1))*(l5 - 30) - a4*cos(x(1) - (1859*pi)/18000 + x(2)))*(sin((1859*pi)/18000 - x(1))*x(3)^2*(l5 - 30) - l6*sin(x(1))*x(3)^2 + a4*sin(x(1) - (1859*pi)/18000 + x(2))*(x(3) + x(4))^2))/100 + (1243*(l4*sin(x(1) - (1859*pi)/18000 + x(2)) + l6*sin(x(1)) - a2*sin((1859*pi)/18000 - x(1)) - sin((1859*pi)/18000 - x(1))*(l5 - 30))*(l6*cos(x(1))*x(3)^2 + l4*cos(x(1) - (1859*pi)/18000 + x(2))*(x(3) + x(4))^2 + a2*cos((1859*pi)/18000 - x(1))*x(3)^2 + cos((1859*pi)/18000 - x(1))*x(3)^2*(l5 - 30)))/50 + (1243*(sin((1859*pi)/18000 - x(1))*x(3)^2*(l5 - 30) - l6*sin(x(1))*x(3)^2 - l4*sin(x(1) - (1859*pi)/18000 + x(2))*(x(3) + x(4))^2 + a2*sin((1859*pi)/18000 - x(1))*x(3)^2)*(l4*cos(x(1) - (1859*pi)/18000 + x(2)) + l6*cos(x(1)) + a2*cos((1859*pi)/18000 - x(1)) + cos((1859*pi)/18000 - x(1))*(l5 - 30)))/50 + (17061194056162975*sin((1859*pi)/18000 - x(1))*(l5 - 30))/35184372088832
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              (1243*l4*sin(x(1) - (1859*pi)/18000 + x(2))*(l6*cos(x(1))*x(3)^2 + l4*cos(x(1) - (1859*pi)/18000 + x(2))*(x(3) + x(4))^2 + a2*cos((1859*pi)/18000 - x(1))*x(3)^2 + cos((1859*pi)/18000 - x(1))*x(3)^2*(l5 - 30)))/50 - (4290322519079623*l4*sin(x(1) - (1859*pi)/18000 + x(2)))/17592186044416 - (8480549018003729*a4*sin(x(1) - (1859*pi)/18000 + x(2)))/35184372088832 + (1243*l4*cos(x(1) - (1859*pi)/18000 + x(2))*(sin((1859*pi)/18000 - x(1))*x(3)^2*(l5 - 30) - l6*sin(x(1))*x(3)^2 - l4*sin(x(1) - (1859*pi)/18000 + x(2))*(x(3) + x(4))^2 + a2*sin((1859*pi)/18000 - x(1))*x(3)^2))/50 + (2457*a4*sin(x(1) - (1859*pi)/18000 + x(2))*(l6*cos(x(1))*x(3)^2 + a4*cos(x(1) - (1859*pi)/18000 + x(2))*(x(3) + x(4))^2 + cos((1859*pi)/18000 - x(1))*x(3)^2*(l5 - 30)))/100 - (2457*a4*cos(x(1) - (1859*pi)/18000 + x(2))*(sin((1859*pi)/18000 - x(1))*x(3)^2*(l5 - 30) - l6*sin(x(1))*x(3)^2 + a4*sin(x(1) - (1859*pi)/18000 + x(2))*(x(3) + x(4))^2))/100];
 
B=[1 0;0 rA/rK];
qdoubledot=[q1doubledot(i);q2doubledot(i)];
u=inv(B)*(Dspringless*qdoubledot+Cspringless);
UsSpringless=[UsSpringless,u]; %storing the calculation 
end
U1springless=UsSpringless(1,:);
U2springless=UsSpringless(2,:);




q1dot=diff(q1)./diff(t);
q1dot=[q1dot;q1dot(n-1)]; %adding elmement so size is same 
q2dot=diff(q2)./diff(t);
q2dot=[q2dot;q2dot(n-1)];
Us=[];
q1doubledot=diff(q1dot)./diff(t);
q1doubledot=[q1doubledot(1);q1doubledot];

q2doubledot=diff(q2dot)./diff(t);
q2doubledot=[q2doubledot(1);q2doubledot];
for i=1:n
x(1)=q1(i);
x(2)=q2(i);
x(3)=q1dot(i);
x(4)=q2dot(i);
D =...
[(1243*(l4*cos(x(1) - (1859*pi)/18000 + x(2)) + l6*cos(x(1)) + a2*cos((1859*pi)/18000 - x(1)) + cos((1859*pi)/18000 - x(1))*(l5 - 30))^2)/50 + (3877*(l6*cos(x(1)) + a5*cos((1859*pi)/18000 - x(1)))^2)/100 + (3877*(l6*sin(x(1)) - a5*sin((1859*pi)/18000 - x(1)))^2)/100 + (1243*(l4*sin(x(1) - (1859*pi)/18000 + x(2)) + l6*sin(x(1)) - a2*sin((1859*pi)/18000 - x(1)) - sin((1859*pi)/18000 - x(1))*(l5 - 30))^2)/50 + (2457*(l6*cos(x(1)) + cos((1859*pi)/18000 - x(1))*(l5 - 30) - a4*cos(x(1) - (1859*pi)/18000 + x(2)))^2)/100 + (1527*a6^2*cos(x(1))^2)/100 + (1527*a6^2*sin(x(1))^2)/100 + (2457*(a4*sin(x(1) - (1859*pi)/18000 + x(2)) + l6*sin(x(1)) - sin((1859*pi)/18000 - x(1))*(l5 - 30))^2)/100, (1243*l4*sin(x(1) - (1859*pi)/18000 + x(2))*(l4*sin(x(1) - (1859*pi)/18000 + x(2)) + l6*sin(x(1)) - a2*sin((1859*pi)/18000 - x(1)) - sin((1859*pi)/18000 - x(1))*(l5 - 30)))/50 - (2457*a4*cos(x(1) - (1859*pi)/18000 + x(2))*(l6*cos(x(1)) + cos((1859*pi)/18000 - x(1))*(l5 - 30) - a4*cos(x(1) - (1859*pi)/18000 + x(2))))/100 + (2457*a4*sin(x(1) - (1859*pi)/18000 + x(2))*(a4*sin(x(1) - (1859*pi)/18000 + x(2)) + l6*sin(x(1)) - sin((1859*pi)/18000 - x(1))*(l5 - 30)))/100 + (1243*l4*cos(x(1) - (1859*pi)/18000 + x(2))*(l4*cos(x(1) - (1859*pi)/18000 + x(2)) + l6*cos(x(1)) + a2*cos((1859*pi)/18000 - x(1)) + cos((1859*pi)/18000 - x(1))*(l5 - 30)))/50];
[                                        (1243*l4*sin(x(1) - (1859*pi)/18000 + x(2))*(l4*sin(x(1) - (1859*pi)/18000 + x(2)) + l6*sin(x(1)) - a2*sin((1859*pi)/18000 - x(1)) - sin((1859*pi)/18000 - x(1))*(l5 - 30)))/50 - (2457*a4*cos(x(1) - (1859*pi)/18000 + x(2))*(l6*cos(x(1)) + cos((1859*pi)/18000 - x(1))*(l5 - 30) - a4*cos(x(1) - (1859*pi)/18000 + x(2))))/100 + (2457*a4*sin(x(1) - (1859*pi)/18000 + x(2))*(a4*sin(x(1) - (1859*pi)/18000 + x(2)) + l6*sin(x(1)) - sin((1859*pi)/18000 - x(1))*(l5 - 30)))/100 + (1243*l4*cos(x(1) - (1859*pi)/18000 + x(2))*(l4*cos(x(1) - (1859*pi)/18000 + x(2)) + l6*cos(x(1)) + a2*cos((1859*pi)/18000 - x(1)) + cos((1859*pi)/18000 - x(1))*(l5 - 30)))/50,                                                                                                                                                                                                                                                                                                                                                                                                                                                                 (2457*a4^2*cos(x(1) - (1859*pi)/18000 + x(2))^2)/100 + (1243*l4^2*cos(x(1) - (1859*pi)/18000 + x(2))^2)/50 + (2457*a4^2*sin(x(1) - (1859*pi)/18000 + x(2))^2)/100 + (1243*l4^2*sin(x(1) - (1859*pi)/18000 + x(2))^2)/50];
 
 
C =...
[(4290322519079623*a2*sin((1859*pi)/18000 - x(1)))/17592186044416 - (4290322519079623*l4*sin(x(1) - (1859*pi)/18000 + x(2)))/17592186044416 - (2635286599611659*a6*sin(x(1)))/17592186044416 - (30442996474885179*l6*sin(x(1)))/35184372088832 - (8480549018003729*a4*sin(x(1) - (1859*pi)/18000 + x(2)))/35184372088832 + (3345450604680551*a5*sin((1859*pi)/18000 - x(1)))/8796093022208 + (3877*(l6*sin(x(1)) - a5*sin((1859*pi)/18000 - x(1)))*(l6*cos(x(1))*x(3)^2 + a5*cos((1859*pi)/18000 - x(1))*x(3)^2))/100 - (3877*(l6*sin(x(1))*x(3)^2 - a5*sin((1859*pi)/18000 - x(1))*x(3)^2)*(l6*cos(x(1)) + a5*cos((1859*pi)/18000 - x(1))))/100 + (2457*(a4*sin(x(1) - (1859*pi)/18000 + x(2)) + l6*sin(x(1)) - sin((1859*pi)/18000 - x(1))*(l5 - 30))*(l6*cos(x(1))*x(3)^2 + a4*cos(x(1) - (1859*pi)/18000 + x(2))*(x(3) + x(4))^2 + cos((1859*pi)/18000 - x(1))*x(3)^2*(l5 - 30)))/100 + (2457*(l6*cos(x(1)) + cos((1859*pi)/18000 - x(1))*(l5 - 30) - a4*cos(x(1) - (1859*pi)/18000 + x(2)))*(sin((1859*pi)/18000 - x(1))*x(3)^2*(l5 - 30) - l6*sin(x(1))*x(3)^2 + a4*sin(x(1) - (1859*pi)/18000 + x(2))*(x(3) + x(4))^2))/100 + (1243*(l4*sin(x(1) - (1859*pi)/18000 + x(2)) + l6*sin(x(1)) - a2*sin((1859*pi)/18000 - x(1)) - sin((1859*pi)/18000 - x(1))*(l5 - 30))*(l6*cos(x(1))*x(3)^2 + l4*cos(x(1) - (1859*pi)/18000 + x(2))*(x(3) + x(4))^2 + a2*cos((1859*pi)/18000 - x(1))*x(3)^2 + cos((1859*pi)/18000 - x(1))*x(3)^2*(l5 - 30)))/50 + (1243*(sin((1859*pi)/18000 - x(1))*x(3)^2*(l5 - 30) - l6*sin(x(1))*x(3)^2 - l4*sin(x(1) - (1859*pi)/18000 + x(2))*(x(3) + x(4))^2 + a2*sin((1859*pi)/18000 - x(1))*x(3)^2)*(l4*cos(x(1) - (1859*pi)/18000 + x(2)) + l6*cos(x(1)) + a2*cos((1859*pi)/18000 - x(1)) + cos((1859*pi)/18000 - x(1))*(l5 - 30)))/50 + (17061194056162975*sin((1859*pi)/18000 - x(1))*(l5 - 30))/35184372088832
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         (1860859*pi)/9600 + (6591*x(2))/8 - (8480549018003729*a4*sin(x(1) - (1859*pi)/18000 + x(2)))/35184372088832 - (4290322519079623*l4*sin(x(1) - (1859*pi)/18000 + x(2)))/17592186044416 + (1243*l4*sin(x(1) - (1859*pi)/18000 + x(2))*(l6*cos(x(1))*x(3)^2 + l4*cos(x(1) - (1859*pi)/18000 + x(2))*(x(3) + x(4))^2 + a2*cos((1859*pi)/18000 - x(1))*x(3)^2 + cos((1859*pi)/18000 - x(1))*x(3)^2*(l5 - 30)))/50 + (1243*l4*cos(x(1) - (1859*pi)/18000 + x(2))*(sin((1859*pi)/18000 - x(1))*x(3)^2*(l5 - 30) - l6*sin(x(1))*x(3)^2 - l4*sin(x(1) - (1859*pi)/18000 + x(2))*(x(3) + x(4))^2 + a2*sin((1859*pi)/18000 - x(1))*x(3)^2))/50 + (2457*a4*sin(x(1) - (1859*pi)/18000 + x(2))*(l6*cos(x(1))*x(3)^2 + a4*cos(x(1) - (1859*pi)/18000 + x(2))*(x(3) + x(4))^2 + cos((1859*pi)/18000 - x(1))*x(3)^2*(l5 - 30)))/100 - (2457*a4*cos(x(1) - (1859*pi)/18000 + x(2))*(sin((1859*pi)/18000 - x(1))*x(3)^2*(l5 - 30) - l6*sin(x(1))*x(3)^2 + a4*sin(x(1) - (1859*pi)/18000 + x(2))*(x(3) + x(4))^2))/100];
 
B=[1 0;0 rA/rK];%input mapping matrixS
qdoubledot=[q1doubledot(i);q2doubledot(i)];
u=inv(B)*(D*qdoubledot+C);
Us=[Us,u]; %storing the calculation 
end
U1=Us(1,:);
U2=Us(2,:);
MotorTourqueGraph=figure(1);
plot(t,U1, t,U2, t,U1springless, t,U2springless )
title('Motor torque by time')
xlabel("Time(s)")
ylabel('$\mathrm{Torque}\ \tau\ \left(\mathrm{N} \cdot \mathrm{m}\right)$', 'Interpreter', 'latex')
legend('u1','u2','u1springless','u2springless')

MotorTourqueGraph=figure(2);
plot(t,U1,  t,U1springless )

figure(3)
plot(t,U2,  t,U2springless )
UDiff=U2-U2springless
Udouble=U2*2
figure(4)
plot(t,UDiff)
legend('udiff')

torque_with_spring = U2
torque_without_spring = U2springless


% Calculate percentage change
percent_change = 100 * (torque_with_spring - torque_without_spring) ./ abs(torque_without_spring);

% Optional: handle division by zero
percent_change(isnan(percent_change) | isinf(percent_change)) = 0;

% Plotting
figure(5);
plot(t, percent_change);
xlabel('Time (s)');
ylabel('Percentage Change in Hip Torque (%)');
title('Torque Percentage Change Over Time (With vs. Without Spring)');
grid on;

%U is the tourqe 